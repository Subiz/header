syntax = "proto3";

package partitioner;

message Configuration {
	string version = 1;
	int32 term = 2;
	// ID of the cluster
	string cluster = 3;

	enum Type {
		// coordinator is in middle of configuration change process
		PENDING = 0;

		NORMAL = 1;
	}
	// indicates current state of coordinator
	string state = 4;

	repeated WorkerConfiguration workers = 5;
	int32 total_partitions = 6;
	int32 next_term = 7;
}

message WorkerConfiguration {
	string id = 4;
	string host = 5;
	repeated int32 partitions = 7;
}

message JoinRequest {
	string version = 1;
	int32 term = 2;

	string cluster = 3;

	// unique string for each workers, ex: web-1, web-2
	string id = 4;

	// used to contact worker, examples:  web-4:9090, 192.168.5.134:9090
	string host = 5;
}

message Empty {
	string version = 1;
	// ID of the cluster
	string cluster = 3;
}

service Coordinator {
	rpc GetConfig(Empty) returns (Configuration) {}
	rpc Join(JoinRequest) returns (Configuration) {}
}

service Worker {
	rpc GetConfig(Empty) returns (Configuration) {}
	rpc Request(Configuration) returns (Empty) {}
}
