syntax = "proto2";

// notibox store all notification in subiz
// it DOESN'T take care of pushing notification to user
import "bitbucket.org/subiz/header/common/common.proto";

package notibox;

// Notification represent an user's notification
message Notification {
	optional common.Context ctx = 1;
	optional string box_id = 3;

	optional string id = 4;
	optional string event = 5; // type

	optional int64 created = 6;
	optional string template = 7;
	optional string data = 8; //json
	optional int64 read = 9;
}

message AddNotificationRequest {
	optional common.Context ctx = 1;
	repeated string box_ids = 2;
	optional Notification notification = 3;
}

message ReadNotification {
	optional common.Context ctx = 1;
	optional string box_id = 2;
	repeated string noti_ids = 3;
	optional bool read = 4;
}

message ListRequest {
	optional common.Context ctx = 1;
	optional string box_id = 3;
	optional string anchor = 4;
	optional int32 limit = 5;
}

message Notifications {
	optional common.Context ctx = 1;
	repeated Notification notifications = 2;
	optional string anchor = 3;
}

message NewCount {
	optional common.Context ctx = 1;
	optional string box_id = 2;
	optional int64 new_count = 3;
}

message AllType {
  optional Notifications nts = 2;
	optional ListRequest listr = 3;
	optional ReadNotification rno = 4;
	optional AddNotificationRequest anorfr = 5;
	optional Notification noti = 6;
}

service YourService {
  rpc Do(AllType) returns (AllType) {}
}

enum Event {
	NotiboxRequested = 0;

	NotiUpsertRequest = 1;
	NotiReadRequest = 2;
	NotiUnreadRequest = 4;
	NotiListRequest = 5;
	NotiDecreaseNewRequest = 6;
	NotiNewReadRequested = 7;

	NotiboxSynced = 101;
}
